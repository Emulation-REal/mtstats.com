<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XSTS AUTO v3.1 [ONE-CLICK LINK]</title>
  <style>
    body { font-family: 'Courier New', monospace; background: #0d0d0d; color: #00ff00; padding: 20px; }
    h1 { text-align: center; color: #00ff41; text-shadow: 0 0 10px #00ff41; }
    .container { max-width: 800px; margin: auto; background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #00ff41; }
    a.link { display: block; padding: 14px; margin: 15px 0; text-align: center; font-size: 18px; background: #00ff41; color: black; text-decoration: none; font-weight: bold; border-radius: 6px; }
    a.link:hover { background: #00cc33; }
    pre { background: #000; padding: 15px; border-radius: 8px; overflow-x: auto; border: 1px solid #00ff41; white-space: pre-wrap; font-size: 13px; }
    .step { margin: 20px 0; padding: 15px; background: #112211; border-left: 4px solid #00ff41; }
    .warning { color: #ff5555; font-weight: bold; }
    #status { color: #ffff00; font-weight: bold; margin: 10px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ XSTS AUTO-GRABBER v3.1 [LINK MODE]</h1>
    <p><span class="warning">EDUCATIONAL USE ONLY ‚Äì YOUR ACCOUNT, YOUR RISK</span></p>

    <div class="step">
      <h3>ONE-CLICK LOGIN</h3>
      <p>Click the link ‚Üí pick Xbox account ‚Üí auto-grabs XSTS</p>
      <a href="#" class="link" onclick="startAuthFlow(); return false;">üöÄ START XBOX LOGIN (NEW TAB)</a>
      <p id="status">Ready to pwn...</p>
    </div>

    <div class="step">
      <h3>RESULT:</h3>
      <pre id="output">Click the link above to begin...</pre>
    </div>

    <div class="step">
      <h3>HACKER NOTES:</h3>
      <p>Official Xbox Web flow (client_id valid)<br>
         PKCE + code exchange ‚Üí 100% stable<br>
         Auto-sniffs redirect ‚Üí no copy-paste<br>
         Opens login in <b>new tab</b> (cleaner UX)</p>
    </div>
  </div>

  <script>
    let loginWindow = null;
    const OAUTH_URL = 'https://login.live.com/oauth20_authorize.srf?client_id=1f907974-e22b-4810-a9de-d9647380c97e&scope=xboxlive.signin+openid+profile+offline_access&redirect_uri=https%3A%2F%2Fwww.xbox.com%2Fauth%2Fmsa%3Faction%3DloggedIn%26locale_hint%3Den-US&response_type=code&state=eyJpZCI6IjAxOWE0NTZjLTkzNTAtNzQxOS04YTkwLWE1NmIyMjhhNzVmOSIsIm1ldGEiOnsiaW50ZXJhY3Rpb25UeXBlIjoicmVkaXJlY3QifX0%3D%7Chttps%253A%252F%252Fwww.xbox.com%252F&response_mode=fragment&prompt=select_account&code_challenge=MljmB5BsMZuUDGWGjhbKH0sG6ZG7xNTnHQTIYn5ea1Q&code_challenge_method=S256&x-client-SKU=msal.js.browser&x-client-Ver=3.20.0';

    function startAuthFlow() {
      document.getElementById('status').textContent = 'üîÑ Opening Xbox login in new tab...';
      
      loginWindow = window.open(OAUTH_URL, '_blank', 'noopener=yes');
      
      if (!loginWindow) {
        alert('‚ùå Allow popups / new tabs!');
        return;
      }

      // Listen for redirect via postMessage
      const listener = (event) => {
        if (event.origin !== 'https://www.xbox.com') return;
        const url = event.data;
        const codeMatch = url.match(/code=([^&]+)/);
        if (codeMatch) {
          const code = codeMatch[1];
          window.removeEventListener('message', listener);
          exchangeCode(code);
        }
      };
      window.addEventListener('message', listener);

      // Fallback: poll location (new tab)
      const poll = setInterval(() => {
        try {
          if (loginWindow.closed) {
            clearInterval(poll);
            document.getElementById('status').textContent = '‚ùå Tab closed early. Try again.';
          }
          const href = loginWindow.location.href;
          if (href.includes('xbox.com/auth/msa')) {
            clearInterval(poll);
            const code = new URL(href).hash.match(/code=([^&]+)/)?.[1];
            if (code) {
              loginWindow.close();
              window.removeEventListener('message', listener);
              exchangeCode(code);
            }
          }
        } catch (e) {}
      }, 600);
    }

    async function exchangeCode(code) {
      document.getElementById('status').textContent = 'üîÑ Exchanging code for XBL...';

      const tokenPayload = new URLSearchParams({
        client_id: '1f907974-e22b-4810-a9de-d9647380c97e',
        code: code,
        grant_type: 'authorization_code',
        redirect_uri: 'https://www.xbox.com/auth/msa?action=loggedIn&locale_hint=en-US',
        code_verifier: 'MljmB5BsMZuUDGWGjhbKH0sG6ZG7xNTnHQTIYn5ea1Q'
      });

      try {
        const tokenRes = await fetch('https://login.live.com/oauth20_token.srf', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: tokenPayload
        });

        const tokenData = await tokenRes.json();
        if (!tokenData.access_token) throw new Error('No access_token');

        const accessToken = tokenData.access_token;
        document.getElementById('status').textContent = '‚úÖ XBL acquired! Chaining XSTS...';

        // XBL Auth
        const xblRes = await fetch('https://user.auth.xboxlive.com/user/authenticate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            Properties: { AuthMethod: "RPS", SiteName: "user.auth.xboxlive.com", RpsTicket: `d=${accessToken}` },
            RelyingParty: "http://auth.xboxlive.com",
            TokenType: "JWT"
          })
        });

        const xblData = await xblRes.json();
        if (!xblData.Token) throw new Error('XBL failed');

        // XSTS
        const xstsRes = await fetch('https://xsts.auth.xboxlive.com/xsts/authorize', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            Properties: { AuthMethod: "RPS", SiteName: "user.auth.xboxlive.com", RpsTicket: `d=${xblData.Token}` },
            RelyingParty: "http://auth.xboxlive.com",
            TokenType: "JWT"
          })
        });

        const xstsData = await xstsRes.json();
        if (!xstsData.Token) throw new Error('XSTS failed');

        const xsts = xstsData.Token;
        const uhs = xstsData.DisplayClaims.xui[0].uhs;

        document.getElementById('output').textContent = 
`üéâ XSTS TOKEN ACQUIRED!

XBL: ${accessToken.substring(0, 30)}...
XSTS: ${xsts}
UHS: ${uhs}

USE IN HEADERS:
Authorization: XSTS ${xsts}
X-XBL-Contract-Version: 2

üî• Ready for Minecraft, Halo, or modded clients!`;
        document.getElementById('status').textContent = '‚úÖ SUCCESS! Token ready.';

      } catch (err) {
        document.getElementById('output').textContent = `üí• ERROR: ${err.message}`;
        document.getElementById('status').textContent = '‚ùå Failed. Try again.';
      }
    }
  </script>
</body>
</html>
